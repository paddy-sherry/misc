<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Secret Santa application</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>
       
        //When DOM loaded we attach click event to button
        $(document).ready(function() {
 
            //after button is clicked we download the data
            $('.button').click(function(){
                //start ajax request
                $.ajax({
                    url: "users.json",
                    //force to handle it as text
                    dataType: "text",
                    success: processData
                });
            });
        });

        function processData(data) {
            //data downloaded so we call parseJSON function 
            //and pass downloaded data
            var json = $.parseJSON(data);

            createDuplicate(json.users);   
        }

        function createDuplicate(users) {
            var original = users.slice();
            var shuffled = shuffle(users);
         
            checkForConflicts(original, shuffled);
        }

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex ;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        function checkForConflicts(original, shuffled) {
            if (original.length !== shuffled.length) {
                return false;
            }

            length = original.length;
            for (var i = 0; i < length; i++) {  
                if (original[i].guid === shuffled[i].guid) {
                    createDuplicate(original);
                }
            }
            
            renderLists(original, shuffled);  
        }

        function renderLists(original, shuffled) {

            var santaList = new Array();
            var personList = new Array();
            
            $("#santa").empty();
            $.each(original, function(key, user) {
                var fullName = user.name.first + ' ' + user.name.last;
                $("#santa").append("<li>" + fullName + "</li>");
            });
    
            $("#person").empty();
            $.each(shuffled, function(key, user) {             
                var fullName = user.name.first + ' ' + user.name.last;
                $("#person").append("<li>" + fullName + "</li>");  
            });
    
            return;
        }
 
    </script>

  <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <h1>Secret Santa application</h1>
    <p>Below is a list of the secret santa pairings.</p>
    <div>
      <!-- Generated Secret Santa assignments should go here -->
    
        <input type="button" value="Get and parse JSON" class="button" />
        <br />
        <div id="santa-results">
            <ul id="santa"></ul>           
        </div>

        <div id="person-results">
            <ul id="person"></ul>  
        </div>



    </div>



  </body>
</html>