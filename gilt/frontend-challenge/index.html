<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Secret Santa application</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>
       
        //When DOM loaded we attach click event to button
        $(document).ready(function() {
            
            //after button is clicked we download the data
            $('.button').click(function(){
                //start ajax request
                $.ajax({
                    url: "users.json",
                    //force to handle it as text
                    dataType: "text",
                    success: processData
                });
            });
        });

        function processData(data) {
         
            //data downloaded so we call parseJSON function 
            //and pass downloaded data
            var json = $.parseJSON(data);

            var list = new Array();

            //loop over items and print out name in div
            $.each(json.users, function(key, user) {   
                var fullName = user.name.first + ' ' + user.name.last;
                list.push(fullName);
            });
        
            var pairs = generatePairs(list);
            renderList(pairs);
        }

       
        // Returns a randomized object that achieves the "secret santa" effect
        function generatePairs(names) {
            
            var randomised = {}, 
                // Create a copy of the passed array
                copy = Array.prototype.slice.call(names);

            // Setting the receiver to the last index item to resolve an undesired permutation
            for (var i = 0, receiver = copy[copy.length-1]; i < names.length; i++ ) {
                while (receiver === names[i] || !receiver)
                    // Grab a random member from the array
                    receiver = copy[Math.floor(Math.random() * copy.length)];

                copy.splice(copy.indexOf(receiver), 1 );
                randomised[names[i]] = receiver;
                receiver = null;
            }
           
            return randomised;
        }

        function renderList(pairs) {
            $.each(pairs, function(key, user) {             
                $("#results").append("<div>" + key + "is with " + user + "</div>");
            });
        }

     
    </script>

  </head>
  <body>
    <h1>Secret Santa application</h1>
    <p>Below is a list of the secret santa pairings.</p>
    <div>
      <!-- Generated Secret Santa assignments should go here -->
    
        <input type="button" value="Get and parse JSON" class="button" />
        <br />
        <span id="results"></span>



    </div>



  </body>
</html>